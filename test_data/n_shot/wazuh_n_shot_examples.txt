NETWORK SCANS
Input (IDS anomaly line):
{"agent": {"ip": "10.229.0.4", "name": "wazuh-client", "id": "30"}, "manager": {"name": "wazuh.manager"}, "data": {"metadata": {"flowints": {"tls": {"anomaly": {"count": "2"}}}}, "tx_id": "0", "app_proto": "tls", "in_iface": "ens3", "src_ip": "54.173.41.153", "src_port": "443", "event_type": "alert", "alert": {"severity": "3", "signature_id": "2230003", "rev": "1", "gid": "1", "signature": "SURICATA TLS invalid handshake message", "action": "allowed", "category": "Generic Protocol Command Decode"}, "flow_id": "1319969355864039.000000", "dest_ip": "10.229.0.4", "proto": "TCP", "tls": {"version": "UNDETERMINED", "ja3": {"string": "771,4865-4867-4866-49195-49199-52393-52392-49196-49200-49162-49161-49171-49172-156-157-47-53-10,0-23-65281-10-11-16-5-51-43-13-28-21,29-23-24-25-256-257,0", "hash": "a75de44db3e351bbd8d38b64c41f444e"}, "sni": "ping.chartbeat.net"}, "dest_port": "58774", "flow": {"pkts_toserver": "7", "start": "2022-01-17T11:18:42.923623+0000", "bytes_toclient": "257", "bytes_toserver": "1830", "pkts_toclient": "3"}, "timestamp": "2022-01-17T11:18:43.274160+0000"}, "rule": {"firedtimes": 9, "mail": false, "level": 3, "description": "Suricata: Alert - SURICATA TLS invalid handshake message", "groups": ["ids", "suricata"], "id": "86601"}, "decoder": {"name": "json"}, "input": {"type": "log"}, "@timestamp": "2022-01-17T11:18:43.274160Z", "location": "/var/log/suricata/eve.json", "id": "1687475310.10001877"}

Result:
{   
    "anomaly_timestamp": "2022-01-17T11:18:43.274160Z",
    "classification": "TP",
    "mitre_technique": ["Network Service Discovery", "Active Scanning: Vulnerability Scanning"],
    "description": "The alert reflects unusual TLS handshakes that could indicate reconnaissance activity probing services"
}

Input (IDS anomaly line):
{"agent": {"ip": "10.229.0.4", "name": "wazuh-client", "id": "30"}, "manager": {"name": "wazuh.manager"}, "data": {"metadata": {"flowints": {"tls": {"anomaly": {"count": "4"}}}}, "tx_id": "0", "app_proto": "tls", "in_iface": "ens3", "src_ip": "10.229.0.4", "src_port": "59354", "event_type": "alert", "alert": {"severity": "3", "signature_id": "2230010", "rev": "1", "gid": "1", "signature": "SURICATA TLS invalid record/traffic", "action": "allowed", "category": "Generic Protocol Command Decode"}, "flow_id": "419518725118999.000000", "dest_ip": "185.54.150.79", "proto": "TCP", "tls": {"version": "UNDETERMINED", "ja3": {"string": "771,4865-4867-4866-49195-49199-52393-52392-49196-49200-49162-49161-49171-49172-156-157-47-53-10,0-23-65281-10-11-35-16-5-51-43-13-45-28-21,29-23-24-25-256-257,0", "hash": "aa7744226c695c0b2e440419848cf700"}, "sni": "geid.wbtrk.net"}, "dest_port": "443", "flow": {"pkts_toserver": "7", "start": "2022-01-17T11:18:46.089111+0000", "bytes_toclient": "1175", "bytes_toserver": "1526", "pkts_toclient": "6"}, "timestamp": "2022-01-17T11:18:46.160088+0000"}, "rule": {"firedtimes": 48, "mail": false, "level": 3, "description": "Suricata: Alert - SURICATA TLS invalid record/traffic", "groups": ["ids", "suricata"], "id": "86601"}, "decoder": {"name": "json"}, "input": {"type": "log"}, "@timestamp": "2022-01-17T11:18:46.160088Z", "location": "/var/log/suricata/eve.json", "id": "1687475313.10093926"}

Result:
{   
    "anomaly_timestamp": "2022-01-17T11:18:46.160088Z",
    "classification": "TP",
    "mitre_technique": ["Network Service Discovery", "Active Scanning: Vulnerability Scanning"],
    "description": "The repeated invalid TLS records from the internal host to an external IP suggest reconnaissance or scanning activity"
}

SERVICE SCANS
Input (IDS anomaly line):
{"agent": {"ip": "192.168.104.155", "name": "wazuh-client", "id": "26"}, "manager": {"name": "wazuh.manager"}, "data": {"protocol": "POST", "srcip": "172.21.128.119", "id": "404", "url": "/sdk"}, "rule": {"firedtimes": 9, "mail": false, "level": 5, "pci_dss": ["6.5", "11.4"], "tsc": ["CC6.6", "CC7.1", "CC8.1", "CC6.1", "CC6.8", "CC7.2", "CC7.3"], "description": "Web server 400 error code.", "groups": ["web", "accesslog", "attack"], "id": "31101", "nist_800_53": ["SA.11", "SI.4"], "gdpr": ["IV_35.7.d"]}, "decoder": {"name": "web-accesslog"}, "full_log": "172.21.128.119 - - [17/Jan/2022:11:21:46 +0000] \"POST /sdk HTTP/1.1\" 404 3269 \"-\" \"Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)\"", "input": {"type": "log"}, "@timestamp": "2022-01-17T11:21:46.000000Z", "location": "/var/log/apache2/intranet-access.log", "id": "1687475492.10116645"}

Result:
{   
    "anomaly_timestamp": "2022-01-17T11:21:46.000000Z",
    "classification": "TP",
    "mitre_technique": ["Network Service Discovery", "Active Scanning: Vulnerability Scanning"],
    description": "The HTTP POST request resulting in a 404 from Nmap Scripting Engine indicates reconnaissance activity"
}

Input (IDS anomaly line):
{"predecoder": {"hostname": "inet-dns", "program_name": "sshd", "timestamp": "Jan 17 11:21:32"}, "agent": {"ip": "10.229.255.254", "name": "wazuh-client", "id": "29"}, "manager": {"name": "wazuh.manager"}, "data": {"srcip": "10.229.2.216", "srcport": "44494"}, "rule": {"firedtimes": 2, "mail": false, "level": 6, "pci_dss": ["11.4"], "tsc": ["CC6.1", "CC6.8", "CC7.2", "CC7.3"], "description": "sshd: insecure connection attempt (scan).", "groups": ["syslog", "sshd", "recon"], "mitre": {"technique": ["SSH"], "id": ["T1021.004"], "tactic": ["Lateral Movement"]}, "id": "5706", "nist_800_53": ["SI.4"], "gdpr": ["IV_35.7.d"], "gpg13": ["4.12"]}, "decoder": {"parent": "sshd", "name": "sshd"}, "full_log": "Jan 17 11:21:32 inet-dns sshd[19201]: Did not receive identification string from 10.229.2.216 port 44494", "input": {"type": "log"}, "@timestamp": "2022-01-17T11:21:32.000000Z", "location": "/var/log/auth.log", "id": "1687475477.10106901"}

Result:
{   
    "anomaly_timestamp": "2022-01-17T11:21:32.000000Z",
    "classification": "TP",
    "mitre_technique": ["Active Scanning", "Network Service Discovery"],
    "description": "The incomplete SSH handshake indicates active probing for available SSH services"
}

WPSCAN
Input (IDS anomaly line):
{"agent": {"ip": "192.168.104.155", "name": "wazuh-client", "id": "26"}, "manager": {"name": "wazuh.manager"}, "data": {"protocol": "HEAD", "srcip": "172.21.128.119", "id": "404", "url": "/wp-content/backup-db/"}, "rule": {"firedtimes": 4146, "mail": false, "level": 5, "pci_dss": ["6.5", "11.4"], "tsc": ["CC6.6", "CC7.1", "CC8.1", "CC6.1", "CC6.8", "CC7.2", "CC7.3"], "description": "Web server 400 error code.", "groups": ["web", "accesslog", "attack"], "id": "31101", "nist_800_53": ["SA.11", "SI.4"], "gdpr": ["IV_35.7.d"]}, "decoder": {"name": "web-accesslog"}, "full_log": "172.21.128.119 - - [17/Jan/2022:11:22:24 +0000] \"HEAD /wp-content/backup-db/ HTTP/1.1\" 404 146 \"https://intranet.smith.santos.com\" \"WPScan v3.8.20 (https://wpscan.com/wordpress-security-scanner)\"", "input": {"type": "log"}, "@timestamp": "2022-01-17T11:22:24.000000Z", "location": "/var/log/apache2/intranet-access.log", "id": "1687475530.13015899"}

Result:
{   
    "anomaly_timestamp": "2022-01-17T11:22:24.000000Z",
    "classification": "TP",
    "mitre_technique": ["Active Scanning: Vulnerability Scanning"],
    "description": "The alert shows WPScan actively probing a WordPress site for exposed backup files which indicates active scanning as long as no pentesing is going on within the organisation."
}

Input (IDS anomaly line):
{"agent": {"ip": "192.168.104.155", "name": "wazuh-client", "id": "26"}, "previous_output": "172.21.128.119 - - [17/Jan/2022:11:22:40 +0000] \"HEAD /wp-content/themes/TheStyle/timthumb.phpthumb.php HTTP/1.1\" 404 146 \"https://intranet.smith.santos.com\" \"WPScan v3.8.20 (https://wpscan.com/wordpress-security-scanner)\"\n172.21.128.119 - - [17/Jan/2022:11:22:40 +0000] \"HEAD /wp-content/themes/TheStyle/timthumb.phptimthumb.php HTTP/1.1\" 404 146 \"https://intranet.smith.santos.com\" \"WPScan v3.8.20 (https://wpscan.com/wordpress-security-scanner)\"\n172.21.128.119 - - [17/Jan/2022:11:22:40 +0000] \"HEAD /wp-content/themes/TheStyle/scripts/timthumb.php HTTP/1.1\" 404 146 \"https://intranet.smith.santos.com\" \"WPScan v3.8.20 (https://wpscan.com/wordpress-security-scanner)\"\n172.21.128.119 - - [17/Jan/2022:11:22:40 +0000] \"HEAD /wp-content/themes/TheStyle/thumb.php HTTP/1.1\" 404 146 \"https://intranet.smith.santos.com\" \"WPScan v3.8.20 (https://wpscan.com/wordpress-security-scanner)\"\n172.21.128.119 - - [17/Jan/2022:11:22:40 +0000] \"HEAD /wp-content/themes/TheStyle/timthumb.php HTTP/1.1\" 404 146 \"https://intranet.smith.santos.com\" \"WPScan v3.8.20 (https://wpscan.com/wordpress-security-scanner)\"\n172.21.128.119 - - [17/Jan/2022:11:22:40 +0000] \"HEAD /wp-content/themes/TheStyle/inc/timthumb.php HTTP/1.1\" 404 146 \"https://intranet.smith.santos.com\" \"WPScan v3.8.20 (https://wpscan.com/wordpress-security-scanner)\"\n172.21.128.119 - - [17/Jan/2022:11:22:40 +0000] \"HEAD /wp-content/themes/TheStyle/includes/timthumb.php HTTP/1.1\" 404 146 \"https://intranet.smith.santos.com\" \"WPScan v3.8.20 (https://wpscan.com/wordpress-security-scanner)\"\n172.21.128.119 - - [17/Jan/2022:11:22:40 +0000] \"HEAD /wp-content/themes/thestation/timthumb.php HTTP/1.1\" 404 146 \"https://intranet.smith.santos.com\" \"WPScan v3.8.20 (https://wpscan.com/wordpress-security-scanner)\"\n172.21.128.119 - - [17/Jan/2022:11:22:40 +0000] \"HEAD /wp-content/themes/thestation/tools/timthumb.php HTTP/1.1\" 404 146 \"https://intranet.smith.santos.com\" \"WPScan v3.8.20 (https://wpscan.com/wordpress-security-scanner)\"\n172.21.128.119 - - [17/Jan/2022:11:22:40 +0000] \"HEAD /wp-content/themes/TheStyle/cache/thimthumb.php HTTP/1.1\" 404 146 \"https://intranet.smith.santos.com\" \"WPScan v3.8.20 (https://wpscan.com/wordpress-security-scanner)\"\n172.21.128.119 - - [17/Jan/2022:11:22:40 +0000] \"HEAD /wp-content/themes/thestation/tools/timthumb.phpthumb.php HTTP/1.1\" 404 146 \"https://intranet.smith.santos.com\" \"WPScan v3.8.20 (https://wpscan.com/wordpress-security-scanner)\"", "manager": {"name": "wazuh.manager"}, "data": {"protocol": "HEAD", "srcip": "172.21.128.119", "id": "404", "url": "/wp-content/themes/the-theme/core/libs/thumbnails/thumb.php"}, "rule": {"firedtimes": 500, "mail": false, "level": 10, "pci_dss": ["6.5", "11.4"], "tsc": ["CC6.6", "CC7.1", "CC8.1", "CC6.1", "CC6.8", "CC7.2", "CC7.3"], "description": "Multiple web server 400 error codes from same source ip.", "groups": ["web", "accesslog", "web_scan", "recon"], "mitre": {"technique": ["Vulnerability Scanning"], "id": ["T1595.002"], "tactic": ["Reconnaissance"]}, "id": "31151", "nist_800_53": ["SA.11", "SI.4"], "frequency": 14, "gdpr": ["IV_35.7.d"]}, "decoder": {"name": "web-accesslog"}, "full_log": "172.21.128.119 - - [17/Jan/2022:11:22:40 +0000] \"HEAD /wp-content/themes/the-theme/core/libs/thumbnails/thumb.php HTTP/1.1\" 404 146 \"https://intranet.smith.santos.com\" \"WPScan v3.8.20 (https://wpscan.com/wordpress-security-scanner)\"", "input": {"type": "log"}, "@timestamp": "2022-01-17T11:22:40.000000Z", "location": "/var/log/apache2/intranet-access.log", "id": "1687475546.14990158"}

Result:
{   
    "anomaly_timestamp": "2022-01-17T11:22:40.000000Z",
    "classification": "TP",
    "mitre_technique": ["Active Scanning: Vulnerability Scanning"],
    "description": "The alert shows repeatedly probing WordPress theme paths for vulnerable files which indicates scanning activity."
}

DIRB
Input (IDS anomaly line):
{"agent": {"ip": "192.168.104.155", "name": "wazuh-client", "id": "26"}, "manager": {"name": "wazuh.manager"}, "data": {"protocol": "GET", "srcip": "172.21.128.119", "id": "403", "url": "/.htpasswd_"}, "rule": {"firedtimes": 27, "mail": false, "level": 5, "pci_dss": ["6.5", "11.4"], "tsc": ["CC6.6", "CC7.1", "CC8.1", "CC6.1", "CC6.8", "CC7.2", "CC7.3"], "description": "Web server 400 error code.", "groups": ["web", "accesslog", "attack"], "id": "31101", "nist_800_53": ["SA.11", "SI.4"], "gdpr": ["IV_35.7.d"]}, "decoder": {"name": "web-accesslog"}, "full_log": "172.21.128.119 - - [17/Jan/2022:11:22:02 +0000] \"GET /.htpasswd_ HTTP/1.1\" 403 366 \"-\" \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)\"", "input": {"type": "log"}, "@timestamp": "2022-01-17T11:22:02.000000Z", "location": "/var/log/apache2/intranet-access.log", "id": "1687475508.10215310"}

Result:
{   
    "anomaly_timestamp": "2022-01-17T11:22:02.000000Z",
    "classification": "TP",
    "mitre_technique": ["Active Scanning: Vulnerability Scanning"],
    "description": "There is a request attempting to access the sensitive .htpasswd file on a web server which indicates scanning."
}

Input (IDS anomaly line):
{"agent": {"ip": "192.168.104.155", "name": "wazuh-client", "id": "26"}, "manager": {"name": "wazuh.manager"}, "data": {"protocol": "GET", "srcip": "172.21.128.119", "id": "404", "url": "/bash"}, "rule": {"firedtimes": 549, "mail": false, "level": 5, "pci_dss": ["6.5", "11.4"], "tsc": ["CC6.6", "CC7.1", "CC8.1", "CC6.1", "CC6.8", "CC7.2", "CC7.3"], "description": "Web server 400 error code.", "groups": ["web", "accesslog", "attack"], "id": "31101", "nist_800_53": ["SA.11", "SI.4"], "gdpr": ["IV_35.7.d"]}, "decoder": {"name": "web-accesslog"}, "full_log": "172.21.128.119 - - [17/Jan/2022:11:22:04 +0000] \"GET /bash HTTP/1.1\" 404 363 \"-\" \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)\"", "input": {"type": "log"}, "@timestamp": "2022-01-17T11:22:04.000000Z", "location": "/var/log/apache2/intranet-access.log", "id": "1687475510.10574229"}

Result:
{   
    "anomaly_timestamp": "2022-01-17T11:22:04.000000Z",
    "classification": "TP",
    "mitre_technique": ["Active Scanning: Vulnerability Scanning"],
    "description": "The alert shows an access attempt for /bash which indicates probing for misconfigured or exposed shells."
}

WEBSHELL
-

PASSWORD CRACKING
Input (IDS anomaly line):
{"agent": {"ip": "192.168.104.155", "name": "wazuh-client", "id": "26"}, "manager": {"name": "wazuh.manager"}, "data": {"metadata": {"flowints": {"http": {"anomaly": {"count": "1"}}}}, "tx_id": "1", "app_proto": "http", "in_iface": "ens3", "src_ip": "10.229.2.216", "src_port": "80", "event_type": "alert", "alert": {"severity": "3", "signature_id": "2221010", "rev": "1", "gid": "1", "signature": "SURICATA HTTP unable to match response to request", "action": "allowed", "category": "Generic Protocol Command Decode"}, "flow_id": "1814861280913956.000000", "dest_ip": "192.168.104.155", "proto": "TCP", "http": {"length": "363896", "http_port": "0", "url": "/libhtp::request_uri_not_seen"}, "dest_port": "44636", "flow": {"pkts_toserver": "38", "start": "2022-01-17T11:24:39.469540+0000", "bytes_toclient": "5996", "bytes_toserver": "2666", "pkts_toclient": "6"}, "timestamp": "2022-01-17T11:24:39.481507+0000"}, "rule": {"firedtimes": 90, "mail": false, "level": 3, "description": "Suricata: Alert - SURICATA HTTP unable to match response to request", "groups": ["ids", "suricata"], "id": "86601"}, "decoder": {"name": "json"}, "input": {"type": "log"}, "@timestamp": "2022-01-17T11:24:39.481507Z", "location": "/var/log/suricata/eve.json", "id": "1687475666.15573167"}

Result:
{   
    "anomaly_timestamp": "2022-01-17T11:24:39.481507Z",
    "classification": "TP",
    "mitre_technique": ["Brute Force: Password Guessing"],
    "description": "The alert shows HTTP traffic anomalies which might be generated because of repeated password attempts."
}

Input (IDS anomaly line):
{"agent": {"ip": "10.229.0.4", "name": "wazuh-client", "id": "30"}, "manager": {"name": "wazuh.manager"}, "data": {"metadata": {"flowints": {"http": {"anomaly": {"count": "1"}}}}, "tx_id": "1", "app_proto": "http", "in_iface": "ens3", "src_ip": "10.229.2.216", "src_port": "80", "event_type": "alert", "alert": {"severity": "3", "signature_id": "2221010", "rev": "1", "gid": "1", "signature": "SURICATA HTTP unable to match response to request", "action": "allowed", "category": "Generic Protocol Command Decode"}, "flow_id": "2203938073291969.000000", "dest_ip": "10.229.0.4", "proto": "TCP", "http": {"length": "363896", "http_port": "0", "url": "/libhtp::request_uri_not_seen"}, "dest_port": "44636", "flow": {"pkts_toserver": "37", "start": "2022-01-17T11:24:39.470209+0000", "bytes_toclient": "5996", "bytes_toserver": "2600", "pkts_toclient": "6"}, "timestamp": "2022-01-17T11:24:39.481555+0000"}, "rule": {"firedtimes": 88, "mail": false, "level": 3, "description": "Suricata: Alert - SURICATA HTTP unable to match response to request", "groups": ["ids", "suricata"], "id": "86601"}, "decoder": {"name": "json"}, "input": {"type": "log"}, "@timestamp": "2022-01-17T11:24:39.481555Z", "location": "/var/log/suricata/eve.json", "id": "1687475666.15569078"}

Result:
{   
    "anomaly_timestamp": "2022-01-17T11:24:39.481555Z",
    "classification": "TP",
    "mitre_technique": ["Brute Force: Password Guessing"],
    "description": "The log shows HTTP anomalies generated during repeated authentication attempts."
}

REVERSE SHELL:
-

PRIVILEGE ESCALATION
Input (IDS anomaly line):
{"predecoder": {"hostname": "intranet-server", "program_name": "su", "timestamp": "Jan 17 11:58:17"}, "agent": {"ip": "192.168.104.155", "name": "wazuh-client", "id": "26"}, "manager": {"name": "wazuh.manager"}, "data": {"srcuser": "www", "dstuser": "data:gmorgan"}, "rule": {"mail": false, "level": 3, "pci_dss": ["10.2.5"], "hipaa": ["164.312.b"], "tsc": ["CC6.8", "CC7.2", "CC7.3"], "description": "User successfully changed UID.", "groups": ["syslog", "su", "authentication_success"], "nist_800_53": ["AU.14", "AC.7"], "gdpr": ["IV_35.7.d", "IV_32.2"], "firedtimes": 1, "mitre": {"technique": ["Valid Accounts"], "id": ["T1078"], "tactic": ["Defense Evasion", "Persistence", "Privilege Escalation", "Initial Access"]}, "id": "5304", "gpg13": ["7.6", "7.8"]}, "decoder": {"parent": "su", "name": "su"}, "full_log": "Jan 17 11:58:17 intranet-server su[20749]: + /dev/pts/1 www-data:gmorgan", "input": {"type": "log"}, "@timestamp": "2022-01-17T11:58:17.000000Z", "location": "/var/log/auth.log", "id": "1687477683.16223775"}

Result:
{   
    "anomaly_timestamp": "2022-01-17T11:58:17.000000Z",
    "classification": "TP",
    "mitre_technique": ["Valid Accounts"],
    "description": "The alert shows a successful user switch (su) demonstrating use of legitimate credentials to escalate privileges."
}

Input (IDS anomaly line):
{"predecoder": {"hostname": "intranet-server", "program_name": "sudo", "timestamp": "Jan 17 11:58:29"}, "agent": {"ip": "192.168.104.155", "name": "wazuh-client", "id": "26"}, "manager": {"name": "wazuh.manager"}, "data": {"srcuser": "gmorgan", "dstuser": "root", "tty": "pts/1", "pwd": "/var/www/intranet.smith.santos.com/wp-content/uploads/2022/01", "command": "/bin/cat /etc/shadow"}, "rule": {"mail": false, "level": 3, "pci_dss": ["10.2.5", "10.2.2"], "hipaa": ["164.312.b"], "tsc": ["CC6.8", "CC7.2", "CC7.3"], "description": "Successful sudo to ROOT executed.", "groups": ["syslog", "sudo"], "nist_800_53": ["AU.14", "AC.7", "AC.6"], "gdpr": ["IV_32.2"], "firedtimes": 1, "mitre": {"technique": ["Sudo and Sudo Caching"], "id": ["T1548.003"], "tactic": ["Privilege Escalation", "Defense Evasion"]}, "id": "5402", "gpg13": ["7.6", "7.8", "7.13"]}, "decoder": {"parent": "sudo", "name": "sudo", "ftscomment": "First time user executed the sudo command"}, "full_log": "Jan 17 11:58:29 intranet-server sudo:  gmorgan : TTY=pts/1 ; PWD=/var/www/intranet.smith.santos.com/wp-content/uploads/2022/01 ; USER=root ; COMMAND=/bin/cat /etc/shadow", "input": {"type": "log"}, "@timestamp": "2022-01-17T11:58:29.000000Z", "location": "/var/log/auth.log", "id": "1687477695.16225611"}
Result:
{   
    "anomaly_timestamp": "2022-01-17T11:58:29.000000Z",
    "classification": "TP",
    "mitre_technique": ["Abuse Elevation Control Mechanism: Sudo and Sudo Caching"],
    "description": "The alert indicates the technique Sudo and Sudo Caching because the user gmorgan successfully executed a sudo command to access root and read /etc/shadow demonstrating privilege escalation."
}

DNSTEAL 
Input (IDS anomaly line):
{"agent": {"ip": "10.132.56.1", "name": "wazuh-client", "id": "30"}, "manager": {"name": "wazuh.manager"}, "data": {"metadata": {"flowints": {"tls": {"anomaly": {"count": "2"}}}}, "tx_id": "0", "app_proto": "tls", "in_iface": "ens3", "src_ip": "34.213.76.57", "src_port": "443", "event_type": "alert", "alert": {"severity": "3", "signature_id": "2230003", "rev": "1", "gid": "1", "signature": "SURICATA TLS invalid handshake message", "action": "allowed", "category": "Generic Protocol Command Decode"}, "flow_id": "1981255141899576.000000", "dest_ip": "192.168.96.4", "proto": "TCP", "tls": {"version": "UNDETERMINED", "ja3": {"string": "771,4865-4867-4866-49195-49199-52393-52392-49196-49200-49162-49161-49171-49172-156-157-47-53-10,0-23-65281-10-11-35-16-5-51-43-13-45-28-21,29-23-24-25-256-257,0", "hash": "aa7744226c695c0b2e440419848cf700"}, "sni": "shavar.services.mozilla.com"}, "dest_port": "39008", "flow": {"pkts_toserver": "6", "start": "2022-01-20T22:57:53.539960+0000", "bytes_toclient": "257", "bytes_toserver": "2198", "pkts_toclient": "3"}, "timestamp": "2022-01-20T22:57:54.110943+0000"}, "rule": {"firedtimes": 1, "mail": false, "level": 3, "description": "Suricata: Alert - SURICATA TLS invalid handshake message", "groups": ["ids", "suricata"], "id": "86601"}, "decoder": {"name": "json"}, "input": {"type": "log"}, "@timestamp": "2022-01-20T22:57:54.110943Z", "location": "/var/log/suricata/eve.json", "id": "1688540918.2845670"}

Result:
{   
    "anomaly_timestamp": "2022-01-20T22:57:54.110943Z",
    "classification": "TP",
    "mitre_technique": ["Exfiltration Over C2 Channel"],
    "description": "The alert indicates exfiltration over C2 channel because the detected invalid TLS handshake likely represents DNS tunneling data over TLS to exfiltrate sensitive information."
}

Input (IDS anomaly line):
{"agent": {"ip": "10.132.56.1", "name": "wazuh-client", "id": "30"}, "manager": {"name": "wazuh.manager"}, "data": {"metadata": {"flowints": {"tls": {"anomaly": {"count": "2"}}}}, "tx_id": "0", "app_proto": "tls", "in_iface": "ens3", "src_ip": "34.213.76.57", "src_port": "443", "event_type": "alert", "alert": {"severity": "3", "signature_id": "2230010", "rev": "1", "gid": "1", "signature": "SURICATA TLS invalid record/traffic", "action": "allowed", "category": "Generic Protocol Command Decode"}, "flow_id": "1981255141899576.000000", "dest_ip": "192.168.96.4", "proto": "TCP", "tls": {"version": "UNDETERMINED", "ja3": {"string": "771,4865-4867-4866-49195-49199-52393-52392-49196-49200-49162-49161-49171-49172-156-157-47-53-10,0-23-65281-10-11-35-16-5-51-43-13-45-28-21,29-23-24-25-256-257,0", "hash": "aa7744226c695c0b2e440419848cf700"}, "sni": "shavar.services.mozilla.com"}, "dest_port": "39008", "flow": {"pkts_toserver": "6", "start": "2022-01-20T22:57:53.539960+0000", "bytes_toclient": "257", "bytes_toserver": "2198", "pkts_toclient": "3"}, "timestamp": "2022-01-20T22:57:54.110943+0000"}, "rule": {"firedtimes": 2, "mail": false, "level": 3, "description": "Suricata: Alert - SURICATA TLS invalid record/traffic", "groups": ["ids", "suricata"], "id": "86601"}, "decoder": {"name": "json"}, "input": {"type": "log"}, "@timestamp": "2022-01-20T22:57:54.110943Z", "location": "/var/log/suricata/eve.json", "id": "1688540918.2847671"}
Result:
{   
    "anomaly_timestamp": "2022-01-20T22:57:54.110943Z",
    "classification": "TP",
    "mitre_technique": ["Exfiltration Over C2 Channel"],
    "description": "The alert shows anomalous TLS traffic from an external IP to an internal host consistent with DNS-based or encrypted channels."
}

NO ATTACK
Input (IDS anomaly line):
{"predecoder": {"hostname": "mail", "program_name": "dovecot", "timestamp": "Jan 14 05:24:34"}, "agent": {"ip": "172.21.131.50", "name": "wazuh-client", "id": "22"}, "manager": {"name": "wazuh.manager"}, "rule": {"mail": false, "level": 3, "pci_dss": ["10.2.5"], "hipaa": ["164.312.b"], "tsc": ["CC6.8", "CC7.2", "CC7.3"], "description": "Dovecot Authentication Success.", "groups": ["dovecot", "authentication_success"], "nist_800_53": ["AU.14", "AC.7"], "gdpr": ["IV_32.2"], "firedtimes": 1, "mitre": {"technique": ["Valid Accounts"], "id": ["T1078"], "tactic": ["Defense Evasion", "Persistence", "Privilege Escalation", "Initial Access"]}, "id": "9701", "gpg13": ["7.1", "7.2"]}, "decoder": {"parent": "dovecot", "name": "dovecot"}, "full_log": "Jan 14 05:24:34 mail dovecot: imap-login: Login: user=<danny.jarvis>, method=PLAIN, rip=172.21.131.50, lip=172.21.131.50, mpid=7889, TLS, session=<RvV0BITVsNqsFYMy>", "input": {"type": "log"}, "@timestamp": "2022-01-14T05:24:34.000000Z", "location": "/var/log/mail.info", "id": "1687194860.7620703"}

Result:
{   
    "anomaly_timestamp": "2022-01-14T05:24:34.000000Z",
    "classification": "FP",
    "mitre_technique": [],
    "description": "This alert is a false positive because itâ€™s a normal, successful login by a legitimate internal user over TLS"
}

Input (IDS anomaly line):
{"predecoder": {"hostname": "hayes-mail", "program_name": "freshclam", "timestamp": "Jan 17 10:25:16"}, "agent": {"ip": "10.229.2.25", "name": "wazuh-client", "id": "21"}, "manager": {"name": "wazuh.manager"}, "rule": {"firedtimes": 1, "mail": false, "level": 3, "pci_dss": ["5.2"], "tsc": ["A1.2"], "description": "ClamAV database update", "groups": ["clamd", "freshclam", "virus"], "id": "52507", "nist_800_53": ["SI.3"], "gpg13": ["4.4"], "gdpr": ["IV_35.7.d"]}, "decoder": {"name": "freshclam"}, "full_log": "Jan 17 10:25:16 hayes-mail freshclam[28734]: Mon Jan 17 10:25:16 2022 -> ClamAV update process started at Mon Jan 17 10:25:16 2022", "input": {"type": "log"}, "@timestamp": "2022-01-17T10:25:16.000000Z", "location": "/var/log/syslog", "id": "1687472101.8942636"}
Result:
{   
    "anomaly_timestamp": "2022-01-17T10:25:16.000000Z",
    "classification": "FP",
    "mitre_technique": [],
    "description": "This alert is a false positive because it simply logs a routine ClamAV virus database update"
}